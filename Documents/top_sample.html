<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Åø„Åã„Çì„ÅÆÊº¢Â≠ó„Ç≠„É£„ÉÉ„ÉÅ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mikan: {
                            50: '#FFF7ED',
                            100: '#FFEDD5',
                            200: '#FED7AA',
                            300: '#FDBA74',
                            400: '#FB923C',
                            500: '#F97316',
                            600: '#EA580C',
                            700: '#C2410C',
                            800: '#9A3412',
                            900: '#7C2D12',
                        },
                        leaf: '#65A30D',
                        brown: '#431407',
                    },
                    fontFamily: {
                        sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bg-slide': 'bg-slide 20s linear infinite',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'bg-slide': {
                            '0%': { backgroundPosition: '0 0' },
                            '100%': { backgroundPosition: '0 1000px' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700;800&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #FFF7ED;
            color: #431407;
            overflow: hidden; /* „Çπ„ÇØ„É≠„Éº„É´Á¶ÅÊ≠¢ */
            user-select: none;
        }

        /* ËÉåÊôØ„ÅÆ„Éë„Çø„Éº„É≥ */
        .bg-pattern {
            background-image: radial-gradient(#FED7AA 2px, transparent 2px);
            background-size: 30px 30px;
        }

        /* ËÉåÊôØ„Å´ËêΩ„Å°„ÇãÊº¢Â≠ó„Ç®„Éï„Çß„ÇØ„Éà */
        .falling-bg-kanji {
            position: absolute;
            color: rgba(251, 146, 60, 0.2);
            font-weight: bold;
            user-select: none;
            pointer-events: none;
            animation: fall linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(110vh); }
        }

        /* --- „Åø„Åã„Çì„Ç≠„É£„É©„ÇØ„Çø„Éº --- */
        .mikan-container {
            position: relative;
            width: 140px;
            height: 120px;
            display: flex;
            justify-content: center;
        }
        
        .mikan-body {
            width: 100px; height: 90px;
            background: #F97316;
            border-radius: 50%;
            position: relative;
            z-index: 10;
            animation: mikan-bounce 0.8s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
        }
        .mikan-leaf {
            position: absolute; top: -12px; left: 45px;
            width: 25px; height: 12px;
            background: #65A30D;
            border-radius: 20px 0 20px 0;
            transform: rotate(-10deg);
        }
        .mikan-face {
            position: absolute; top: 30px; left: 25px; width: 50px;
            display: flex; justify-content: space-between;
        }
        .eye { width: 10px; height: 10px; background: #431407; border-radius: 50%; }
        .mouth {
            position: absolute; top: 6px; left: 18px; width: 14px; height: 7px;
            border-bottom: 3px solid #431407; border-radius: 0 0 10px 10px;
            transition: all 0.2s;
        }
        /* Âñú„Å≥„ÅÆË°®ÊÉÖ */
        .mikan-body.happy .mouth {
            height: 14px;
            background: #431407;
            border-radius: 0 0 14px 14px;
        }
        .mikan-body.happy {
            animation: mikan-jump 0.4s ease-out;
        }

        .mikan-shadow {
            position: absolute; bottom: 0;
            width: 80px; height: 12px; background: rgba(0,0,0,0.1);
            border-radius: 50%;
            animation: mikan-shadow 0.8s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
        }

        @keyframes mikan-bounce {
            0% { transform: translateY(0) scale(1.1, 0.9); }
            100% { transform: translateY(-30px) scale(0.95, 1.05); }
        }
        @keyframes mikan-shadow {
            0% { transform: scale(1); opacity: 0.5; }
            100% { transform: scale(0.6); opacity: 0.2; }
        }
        @keyframes mikan-jump {
            0% { transform: translateY(0) scale(1.2, 0.8); }
            50% { transform: translateY(-50px) scale(0.9, 1.1); }
            100% { transform: translateY(0) scale(1, 1); }
        }

        /* „Ç≤„Éº„É†„Ç®„É™„Ç¢ */
        #game-play-area {
            position: relative;
            background: rgba(255, 255, 255, 0.6);
            border: 4px solid #FED7AA;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 4px 6px rgba(0,0,0,0.05);
        }
        .falling-item {
            position: absolute;
            width: 60px; height: 60px;
            background: white;
            border: 3px solid #F97316;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 800; color: #431407;
            box-shadow: 0 4px 0 #FDBA74;
            z-index: 20;
        }

        /* UI„Éë„Éº„ÉÑ */
        .btn-push {
            background: white;
            border: 2px solid #F97316;
            color: #C2410C;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 0 #FDBA74;
            transition: all 0.1s;
        }
        .btn-push:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #FDBA74;
        }
        .btn-push.correct {
            background: #BBF7D0; border-color: #16A34A; color: #14532D; box-shadow: 0 4px 0 #86EFAC;
        }
        .btn-push.wrong {
            background: #FECACA; border-color: #DC2626; color: #7F1D1D; box-shadow: 0 4px 0 #FCA5A5;
        }

        /* Âêπ„ÅçÂá∫„Åó */
        .speech-bubble {
            position: absolute;
            bottom: 100px; left: 100px;
            background: white;
            border: 3px solid #F97316;
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 1rem;
            font-weight: bold;
            color: #EA580C;
            white-space: nowrap;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -10px; left: 20px;
            border-width: 10px 10px 0; border-style: solid;
            border-color: #F97316 transparent; display: block; width: 0;
        }
        .speech-bubble.show { opacity: 1; transform: scale(1); bottom: 110px; }

    </style>
</head>
<body class="h-screen w-full relative bg-pattern">

    <!-- ËÉåÊôØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ („Åä„Å°„ÇÇ„ÅÆ„Ç§„É°„Éº„Ç∏) -->
    <div id="bg-effects" class="absolute inset-0 overflow-hidden pointer-events-none z-0"></div>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="relative z-10 w-full h-full max-w-md mx-auto flex flex-col">
        
        <!-- --- ÁîªÈù¢1: „Éà„ÉÉ„Éó„Éö„Éº„Ç∏ („Éú„Çø„É≥1„Å§„Å´Â§âÊõ¥) --- -->
        <div id="home-screen" class="flex-grow flex flex-col items-center justify-center p-6 space-y-12">
            
            <!-- „Çø„Ç§„Éà„É´„É≠„Ç¥ -->
            <div class="text-center">
                <h1 class="text-4xl font-black text-mikan-600 drop-shadow-sm tracking-tighter transform -rotate-2">
                    <span class="inline-block text-mikan-500">„Åø</span>
                    <span class="inline-block text-mikan-600 transform rotate-3">„Åã</span>
                    <span class="inline-block text-mikan-500">„Çì</span>
                    <span class="text-2xl text-brown ml-1">„ÅÆ</span>
                    <br>
                    <span class="text-5xl text-mikan-500 mt-2 inline-block">Êº¢Â≠ó„Ç≠„É£„ÉÉ„ÉÅ</span>
                </h1>
                <p class="text-mikan-800 font-bold mt-4 bg-white/70 inline-block px-4 py-1 rounded-full text-sm">„Åä„Å°„Å¶„Åè„Çã „Åã„Çì„Åò„Çí „Çà„ÇÇ„ÅÜÔºÅ</p>
            </div>

            <!-- „É°„Ç§„É≥„Ç≠„É£„É©„ÇØ„Çø„Éº (Â∞ë„ÅóÂ§ß„Åç„Åè) -->
            <div class="mikan-container transform scale-150">
                <div class="mikan-body">
                    <div class="mikan-leaf"></div>
                    <div class="mikan-face"><div class="eye"></div><div class="mouth"></div><div class="eye"></div></div>
                </div>
                <div class="mikan-shadow"></div>
            </div>

            <!-- „Çπ„Çø„Éº„Éà„Éú„Çø„É≥ („Åì„Çå1„Å§„Å´ÈõÜÁ¥Ñ) -->
            <div class="w-full max-w-xs">
                <button onclick="startGame()" class="w-full bg-gradient-to-b from-mikan-400 to-mikan-600 text-white text-2xl font-black py-6 rounded-full shadow-xl border-b-8 border-mikan-800 active:border-b-0 active:translate-y-2 transition-all animate-float hover:scale-105">
                    „Çà„ÇÄ„Çå„Çì„Åó„ÇÖ„ÅÜ„Çí„Åô„Çã
                </button>
            </div>

        </div>

        <!-- --- ÁîªÈù¢2: „Ç≤„Éº„É†„Éó„É¨„Ç§ --- -->
        <div id="game-screen" class="hidden h-full flex flex-col p-4">
            
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <div class="flex justify-between items-center mb-2">
                <div class="bg-white/80 rounded-full px-4 py-1 border-2 border-mikan-200 font-bold text-mikan-800">
                    üíñ <span id="game-life">3</span>
                </div>
                <div class="bg-white/80 rounded-full px-4 py-1 border-2 border-mikan-200 font-bold text-mikan-800">
                    ‚è±Ô∏è <span id="game-time">30</span>
                </div>
                <div class="bg-mikan-100 rounded-full px-4 py-1 border-2 border-mikan-300 font-black text-mikan-800 text-xl">
                    <span id="game-score">0</span> ÁÇπ
                </div>
            </div>

            <!-- „Ç≤„Éº„É†„Ç®„É™„Ç¢ -->
            <div id="game-play-area" class="flex-grow mb-4 relative">
                <!-- ËêΩ‰∏ã„Åô„ÇãÊº¢Â≠ó„ÅØJS„Åß„Åì„Åì„Å´ËøΩÂä† -->
            </div>

            <!-- „Ç≠„É£„É©„ÇØ„Çø„ÉºÂøúÊè¥„Ç®„É™„Ç¢ (Áµ∂ÂØæÈÖçÁΩÆ) -->
            <div class="absolute bottom-32 left-4 z-20 pointer-events-none">
                <div class="speech-bubble" id="mikan-speech">„Åå„Çì„Å∞„ÇåÔºÅ</div>
                <div class="mikan-container transform scale-75 origin-bottom-left" id="game-mikan">
                    <div class="mikan-body">
                        <div class="mikan-leaf"></div>
                        <div class="mikan-face"><div class="eye"></div><div class="mouth"></div><div class="eye"></div></div>
                    </div>
                    <!-- ÂΩ±„ÅØÁúÅÁï• -->
                </div>
            </div>

            <!-- Êìç‰Ωú„Éú„Çø„É≥ -->
            <div id="game-controls" class="grid grid-cols-3 gap-3 h-20 mb-2 relative z-30">
                <!-- JS„ÅßÁîüÊàê -->
            </div>
            
            <button onclick="stopGame()" class="mx-auto text-xs text-mikan-400 font-bold underline mt-2">„ÇÑ„ÇÅ„Çã</button>
        </div>

        <!-- --- ÁîªÈù¢3: ÁµêÊûúÁô∫Ë°® („É¢„Éº„ÉÄ„É´) --- -->
        <div id="result-screen" class="hidden absolute inset-0 z-50 bg-black/50 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl p-8 w-full max-w-sm text-center border-8 border-mikan-200 shadow-2xl relative overflow-hidden">
                <!-- ËÉåÊôØ„Ç≠„É©„Ç≠„É© -->
                <div class="absolute top-0 left-0 w-full h-full bg-pattern opacity-30"></div>
                
                <div class="relative z-10">
                    <div class="text-6xl mb-4 animate-bounce">üçä</div>
                    <h2 class="text-3xl font-black text-mikan-600 mb-2">„Åä„Åó„Åæ„ÅÑÔºÅ</h2>
                    <div class="text-mikan-800 font-bold mb-6">
                        „Çπ„Ç≥„Ç¢: <span id="final-score" class="text-5xl">0</span> ÁÇπ
                    </div>
                    
                    <div class="space-y-3">
                        <button onclick="startGame()" class="w-full bg-mikan-500 text-white font-bold py-3 rounded-xl shadow-md hover:bg-mikan-600">
                            „ÇÇ„ÅÜ„ÅÑ„Å°„Å©
                        </button>
                        <button onclick="goHome()" class="w-full bg-white border-2 border-mikan-300 text-mikan-600 font-bold py-3 rounded-xl">
                            „Éà„ÉÉ„Éó„Å∏„ÇÇ„Å©„Çã
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Á∞°ÊòìÊº¢Â≠ó„Éá„Éº„Çø (ÂÖ®Â≠¶Âπ¥ÂàÜ„ÅÆ‰∏ÄÈÉ®)
        const kanjiData = [
            { char: 'Â±±', read: '„ÇÑ„Åæ', grade: 1 }, { char: 'Â∑ù', read: '„Åã„Çè', grade: 1 }, { char: 'Áî∞', read: '„Åü', grade: 1 },
            { char: 'Êó•', read: '„Å≤', grade: 1 }, { char: 'Êúà', read: '„Å§„Åç', grade: 1 }, { char: 'ÁÅ´', read: '„Å≤', grade: 1 },
            { char: 'Ê∞¥', read: '„Åø„Åö', grade: 1 }, { char: 'Êú®', read: '„Åç', grade: 1 }, { char: 'Èáë', read: '„Åã„Å≠', grade: 1 },
            { char: 'Âúü', read: '„Å§„Å°', grade: 1 }, { char: 'Á©∫', read: '„Åù„Çâ', grade: 1 }, { char: 'Èõ®', read: '„ÅÇ„ÇÅ', grade: 1 },
            { char: 'Èõ™', read: '„ÇÜ„Åç', grade: 2 }, { char: 'Èõ≤', read: '„Åè„ÇÇ', grade: 2 }, { char: 'È¢®', read: '„Åã„Åú', grade: 2 },
            { char: 'Êµ∑', read: '„ÅÜ„Åø', grade: 2 }, { char: 'Ê±†', read: '„ÅÑ„Åë', grade: 2 }, { char: 'Ë∞∑', read: '„Åü„Å´', grade: 2 },
            { char: 'Â≤©', read: '„ÅÑ„Çè', grade: 2 }, { char: 'Êòü', read: '„Åª„Åó', grade: 2 }, { char: 'Êô¥', read: '„ÅØ„Çå', grade: 2 },
            { char: 'ÂÖâ', read: '„Å≤„Åã„Çä', grade: 2 }, { char: 'Êúù', read: '„ÅÇ„Åï', grade: 2 }, { char: 'Êòº', read: '„Å≤„Çã', grade: 2 },
            { char: 'ÊÑõ', read: '„ÅÇ„ÅÑ', grade: 4 }, { char: 'Âãá', read: '„ÇÜ„ÅÜ', grade: 5 }, { char: 'Â§¢', read: '„ÇÜ„ÇÅ', grade: 5 }
        ];

        // ËÉåÊôØ„Ç®„Éï„Çß„ÇØ„ÉàÁîüÊàê
        function createBgEffects() {
            const container = document.getElementById('bg-effects');
            const kanjis = ['Â±±', 'Â∑ù', 'Á©∫', 'Â§¢', 'Ëä±', 'Êµ∑', 'Êòü', 'ÂÖâ'];
            
            setInterval(() => {
                const el = document.createElement('div');
                el.className = 'falling-bg-kanji';
                el.innerText = kanjis[Math.floor(Math.random() * kanjis.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.fontSize = (Math.random() * 2 + 1) + 'rem';
                el.style.animationDuration = (Math.random() * 10 + 10) + 's';
                el.style.opacity = Math.random() * 0.3;
                container.appendChild(el);
                
                setTimeout(() => el.remove(), 20000);
            }, 1000);
        }
        createBgEffects();

        // „Ç≤„Éº„É†Áä∂ÊÖãÁÆ°ÁêÜ
        let selectedGrade = 1;
        let gameTimer, fallLoop;
        let score = 0;
        let lives = 3;
        let timeLeft = 30;
        let isPlaying = false;
        let currentTarget = null;
        let fallingSpeed = 1.5;
        let fallY = -60;

        function goHome() {
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
        }

        function startGame() {
            // ÁîªÈù¢Âàá„ÇäÊõø„Åà
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');

            // ÂàùÊúüÂåñ
            score = 0;
            lives = 3;
            timeLeft = 30;
            fallingSpeed = 1.5; // Ê®ôÊ∫ñ„Çπ„Éî„Éº„Éâ
            isPlaying = true;
            updateUI();
            
            mikanSay("„ÅØ„Åò„Åæ„Çã„ÇàÔºÅ");

            // „Çø„Ç§„Éû„Éº„Çπ„Çø„Éº„Éà
            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                if (!isPlaying) return;
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) gameOver();
            }, 1000);

            nextRound();
        }

        function stopGame() {
            isPlaying = false;
            clearInterval(gameTimer);
            clearInterval(fallLoop);
            goHome();
        }

        function updateUI() {
            document.getElementById('game-score').innerText = score;
            document.getElementById('game-time').innerText = timeLeft;
            document.getElementById('game-life').innerText = lives; // „Éè„Éº„Éà„ÅÆÊï∞„Å™„Å©„ÅßË°®Áèæ„ÇÇÂèØ
        }

        function mikanSay(text) {
            const bubble = document.getElementById('mikan-speech');
            bubble.innerText = text;
            bubble.classList.add('show');
            
            // „Åø„Åã„Çì„ÇíË∑≥„Å≠„Åï„Åõ„Çã
            const mikan = document.querySelector('#game-mikan .mikan-body');
            mikan.classList.add('happy');
            setTimeout(() => mikan.classList.remove('happy'), 400);

            setTimeout(() => bubble.classList.remove('show'), 1500);
        }

        function nextRound() {
            if (!isPlaying) return;

            // „Éá„Éº„ÇøÈÅ∏Êäû (ÂÖ®Â≠¶Âπ¥„Éü„ÉÉ„ÇØ„Çπ)
            let pool = kanjiData;
            
            currentTarget = pool[Math.floor(Math.random() * pool.length)];

            // ËêΩ‰∏ãË¶ÅÁ¥†‰ΩúÊàê
            const area = document.getElementById('game-play-area');
            area.innerHTML = ''; // „ÇØ„É™„Ç¢
            
            const el = document.createElement('div');
            el.className = 'falling-item';
            el.innerText = currentTarget.char;
            // „É©„É≥„ÉÄ„É†„Å™X‰ΩçÁΩÆ (Ë¶™Ë¶ÅÁ¥†„ÅÆÂπÖ - Ëá™Ë∫´„ÅÆÂπÖ)
            const maxX = area.clientWidth - 60;
            el.style.left = Math.floor(Math.random() * maxX) + 'px';
            area.appendChild(el);

            fallY = -60;

            // ÈÅ∏ÊäûËÇ¢‰ΩúÊàê
            const opts = [currentTarget.read];
            // „ÉÄ„Éü„Éº‰ΩúÊàê
            while (opts.length < 3) {
                const d = kanjiData[Math.floor(Math.random() * kanjiData.length)].read;
                if (!opts.includes(d)) opts.push(d);
            }
            opts.sort(() => 0.5 - Math.random()); // „Ç∑„É£„ÉÉ„Éï„É´

            const controls = document.getElementById('game-controls');
            controls.innerHTML = '';
            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-push';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                controls.appendChild(btn);
            });

            // ËêΩ‰∏ã„É´„Éº„Éó
            clearInterval(fallLoop);
            fallLoop = setInterval(() => {
                if (!isPlaying) return;
                fallY += fallingSpeed;
                el.style.top = fallY + 'px';

                // Âú∞Èù¢Âà∞ÈÅîÂà§ÂÆö
                if (fallY > 300) { // „Ç®„É™„Ç¢„ÅÆÈ´ò„Åï(Êé®ÂÆö)„Çà„ÇäÂ§ß„Åç„Åè
                    handleMiss();
                }
            }, 20);
        }

        function checkAnswer(ans, btnElement) {
            if (!isPlaying) return;

            if (ans === currentTarget.read) {
                // Ê≠£Ëß£
                score += 10;
                fallingSpeed += 0.1; // Âä†ÈÄü
                mikanSay("„Åô„Åî„ÅÑÔºÅ");
                
                // „Éú„Çø„É≥ÊºîÂá∫
                btnElement.classList.add('correct');
                
                // ËêΩ‰∏ãÁâ©„ÇíÊ∂à„Åó„Å¶Ê¨°„Å∏
                const item = document.querySelector('.falling-item');
                if (item) {
                    item.style.background = '#BBF7D0';
                    item.style.borderColor = '#22C55E';
                    item.innerText = '‚≠ïÔ∏è';
                }
                
                clearInterval(fallLoop);
                setTimeout(nextRound, 500);
            } else {
                // ‰∏çÊ≠£Ëß£
                lives--;
                updateUI();
                btnElement.classList.add('wrong');
                mikanSay("„ÅÇ„Å°„ÇÉ„Éº");
                if (lives <= 0) gameOver();
            }
        }

        function handleMiss() {
            clearInterval(fallLoop);
            lives--;
            updateUI();
            
            const item = document.querySelector('.falling-item');
            if(item) {
                item.style.background = '#FECACA';
                item.innerText = 'üí•';
            }

            mikanSay("„Åä„Å°„Å°„ÇÉ„Å£„Åü...");

            if (lives <= 0) {
                gameOver();
            } else {
                setTimeout(nextRound, 1000);
            }
        }

        function gameOver() {
            isPlaying = false;
            clearInterval(gameTimer);
            clearInterval(fallLoop);
            
            document.getElementById('final-score').innerText = score;
            document.getElementById('result-screen').classList.remove('hidden');
        }

    </script>
</body>
</html>