# 次回セッション実装タスク

## 実装内容：ゲーム終了後の集計画面アニメーション

### 現状
- ゲーム終了後、すぐにリザルト画面（「おしまい！」または得点に応じた動的メッセージ）が表示される
- 集計プロセスが視覚化されていないため、子供にとって唐突な終了体験になっている

### 実装する機能
ゲーム終了（ライフ0または時間切れ）後、**3秒間の楽しい集計アニメーション**を追加する。

#### 集計画面の仕様
1. **表示タイミング**: ゲーム終了直後（`isGameOver === true`）
2. **表示時間**: 3秒間
3. **アニメーション内容**:
   - みかんキャラクターが画面中央に登場
   - 「けいさんちゅう...」または「しゅうけいちゅう...」などの楽しいメッセージ
   - 数字がカウントアップするようなアニメーション効果（オプション）
   - ローディング風のエフェクト（点滅、バウンスなど）

4. **画面遷移フロー**:
   ```
   ゲームプレイ中
   ↓
   ゲーム終了（ライフ0 or 時間切れ）
   ↓
   【新規】集計画面（3秒間）← ここを実装
   ↓
   リザルト画面（既存）
   ```

### 実装ファイル
- **主な修正ファイル**: `app/play/reading/[stage]/page.tsx`

### 実装の技術的ポイント

1. **状態管理の追加**:
   ```typescript
   const [showScoreCalculation, setShowScoreCalculation] = useState(false)
   ```

2. **ゲーム終了検知の修正**:
   ```typescript
   // 現在（100-105行目付近）
   useEffect(() => {
     if (gameState?.isGameOver) {
       setShowResult(true)  // ← これを変更
     }
   }, [gameState?.isGameOver])

   // 修正後
   useEffect(() => {
     if (gameState?.isGameOver) {
       setShowScoreCalculation(true)  // まず集計画面を表示
       setTimeout(() => {
         setShowScoreCalculation(false)
         setShowResult(true)  // 3秒後にリザルト表示
       }, 3000)
     }
   }, [gameState?.isGameOver])
   ```

3. **集計画面のUIコンポーネント追加**:
   - Framer Motionの`motion.div`と`AnimatePresence`を使用
   - みかんキャラクターを中央配置（サイズ大きめ、例: 200px）
   - バウンスアニメーション、フェードイン効果
   - 「けいさんちゅう...」テキストに点滅やタイピング風アニメーション

4. **条件分岐レンダリング**:
   ```typescript
   {showScoreCalculation && (
     <motion.div>
       {/* 集計画面のUI */}
     </motion.div>
   )}

   {showResult && !showScoreCalculation && (
     <motion.div>
       {/* 既存のリザルト画面 */}
     </motion.div>
   )}
   ```

### UI/UXの要件
- **子供が楽しめる表現**: ワクワク感を演出する動き
- **わかりやすさ**: 「今、計算しているんだ」と直感的に理解できる
- **適切なテンポ**: 3秒という短い時間で退屈させない

### デザイン案（参考）
```
┌─────────────────────────────┐
│                             │
│       🍊（バウンス）        │
│      サイズ: 200px          │
│                             │
│   けいさんちゅう...         │
│      （点滅・揺れ）         │
│                             │
│   ● ● ●（ローディング）    │
│                             │
└─────────────────────────────┘
```

### 参考情報
- 既存の`MikanCharacter`コンポーネント: `components/game/MikanCharacter.tsx`
- アニメーション参考: カウントダウン実装（同ファイル68-87行目）
- Framer Motion使用例: リザルトモーダル（同ファイル320行目以降）

### 確認事項
- 集計画面の表示中は、背景のゲーム画面が見えていても問題ない
- 集計画面は全画面オーバーレイで表示（z-indexを適切に設定）
- アニメーションは過度に派手すぎず、子供向けに親しみやすいトーン

### テスト方法
1. ゲームを開始
2. 意図的にライフを0にする、または30秒待つ
3. 集計画面が3秒間表示されることを確認
4. その後、リザルト画面（得点に応じた動的タイトル）が表示されることを確認

---

## 実装後の次ステップ（参考）
- ヘッダーの実装（Pattern 1: 🍊 みかんキャッチ | [ホーム] [ずかん] [せってい]）は承認済みだが未実装
