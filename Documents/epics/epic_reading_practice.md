# Epic: 漢字の読み攻略（メインゲーム）

## 概要
ゲームのメインパートとなる「落ち物パズル」を通じて、反復的かつ直感的に漢字の「読み」を脳にインストールする。

**実装済み（2026-01-25）**: 30秒間の連続ゲームプレイ形式で、学年別・速度別のステージ選択が可能。

## ユーザーストーリー

### 1. 精霊（漢字）のキャッチ
*   **As a (誰):** 子供
*   **I want to (何):** 上から落ちてくる「漢字の精霊」に対し、地面に着く前に正しい「読み（ひらがな）」ボタンを選んでキャッチしたい。
*   **So that (なぜ):** 制限時間（30秒）内にできるだけ多くの精霊をキャッチして高スコアを目指したいから。

### 2. 即時のフィードバック（肯定）
*   **As a (誰):** 子供
*   **I want to (何):** 正解した瞬間に「⭕️」エフェクトと「すごい！」メッセージで賞賛されたい。
*   **So that (なぜ):** 自分のアクションが正しかったと直感的に理解し、「私ってすごい！」という自己肯定感を満たしたいから。

### 3. ストレスフリーなリトライ
*   **As a (誰):** 子供
*   **I want to (何):** 読みを間違えても「あちゃー」という優しいメッセージで即座に次の問題に進みたい。
*   **So that (なぜ):** 失敗を恐れずに何度でもトライ＆エラーを繰り返し、自然と正しい読みをインストールしたいから。

### 4. 難易度の自己調整
*   **As a (誰):** 子供
*   **I want to (何):** 自分の学年（1-6年生）と精霊が落ちてくるスピード（「ゆっくり」「ふつう」「はやい」）を選びたい。
*   **So that (なぜ):** 難しすぎて挫折したり、簡単すぎて退屈したりすることなく、ちょうどいい没入感（フロー状態）で遊び続けたいから。

## 完了基準 (Acceptance Criteria)
*   [x] 漢字オブジェクトが画面上部から下部へアニメーション落下すること。
*   [x] 画面下部に3つのひらがな選択肢が横並びで表示され、1つが正解、2つがダミーであること。
*   [x] 正解時、⭕️エフェクトと「すごい！」メッセージが表示され、スコアが+10点加算されること。
*   [x] 不正解時、ライフが1減り、「あちゃー」メッセージが表示され、即座に次の問題へ進むこと（0.3秒後）。
*   [x] 漢字が地面に落ちた（見逃し）時、💥エフェクトと「おちちゃった...」メッセージが表示され、ライフが1減ること。
*   [x] 学年選択（1-6年生）と速度選択（ゆっくり/ふつう/はやい）のステージ選択画面が実装されていること。
*   [x] ゲーム中のHUD（ライフ💖、タイマー⏱️、スコア）が画面上部に表示されること。
*   [x] ゲーム領域が画面幅の80%に収まり、左右にマージンが確保されていること。
*   [x] ライフが0または時間が0になったらゲーム終了し、リザルト画面が表示されること。

## ゲーム仕様（2026-01-25時点）

### ゲームルール
- **制限時間**: 30秒
- **初期ライフ**: 3
- **スコアルール**: 正解1問につき+10点
- **終了条件**: ライフが0になる、または30秒経過

### 学年別・速度別設定

#### 速度設定
| 速度 | 表示名 | 基本落下時間 | 説明 |
|------|--------|-------------|------|
| slow | ゆっくり | 8秒 | 初心者向け、ゆっくり落ちる |
| normal | ふつう | 5秒 | 標準的な速度 |
| fast | はやい | 3秒 | 上級者向け、速く落ちる |

#### 学年補正
- 学年が上がるごとに落下時間が**0.1秒短縮**（最小2秒）
- 例: 6年生「はやい」モード = 3 - (6 × 0.1) = 2.4秒

#### 正解によるスピードアップ
- 正解するたびに落下時間が**0.1秒短縮**
- ゲームが進むほど難易度が上昇

### UI/UXの特徴
- **画面幅**: コンテンツ全体が画面幅の80%に収まるよう制約
- **HUD配置**: 中央寄せ、各要素間のマージン20px（gap-5）、px-8 py-3のパディング
- **選択肢配置**: 横3列のグリッドレイアウト
- **フィードバック速度**:
  - 正解時: 0.5秒後に次の問題
  - 不正解時: 0.3秒後に次の問題
  - 見逃し時: 0.3秒後に次の問題
- **落下判定**: 漢字が画面下部（100vh - 400px）に到達した瞬間に見逃し判定
- **キャラクター**: 左下にみかんキャラクター（🍊、サイズ80px）が配置され、状況に応じてメッセージを表示

### ステージ選択画面
- **学年選択**: 3×2グリッドで1-6年生ボタン
- **速度選択**: 3列グリッドで「ゆっくり」「ふつう」「はやい」ボタン
- **マージン**:
  - がくねんエリアとはやさエリアの間隔: 24px（space-y-6）
  - はやさエリアとスタートボタンの間隔: 40px
- **スタート条件**: 学年と速度の両方を選択すると「スタート！」ボタンが有効化

### フィードバック表現
| 状況 | エフェクト | メッセージ | ライフ変動 | スコア変動 |
|------|-----------|-----------|----------|----------|
| 正解 | ⭕️（緑円） | すごい！ | - | +10点 |
| 不正解 | 赤ハイライト | あちゃー | -1 | - |
| 見逃し | 💥（爆発） | おちちゃった... | -1 | - |

## 実装ファイル構成

### コアロジック
- `lib/game/reading-game-logic.ts` - ゲーム状態管理、設定生成、回答判定
- `lib/data/kanji-data.ts` - 漢字データ（学年別）、選択肢生成

### コンポーネント
- `components/game/FallingKanji.tsx` - 落下アニメーション、フィードバック表示
- `components/game/AnswerButtons.tsx` - 3択ボタン、正解・不正解のビジュアルフィードバック
- `components/game/MikanCharacter.tsx` - みかんキャラクター

### 画面
- `app/play/reading/page.tsx` - ステージ選択（学年・速度）
- `app/play/reading/[stage]/page.tsx` - ゲームプレイ画面

## 今後の拡張予定
- [ ] BGM・効果音の追加
- [ ] より多様なフィードバックメッセージ
- [ ] ハイスコア記録・表示機能
- [ ] コンボシステムの追加
